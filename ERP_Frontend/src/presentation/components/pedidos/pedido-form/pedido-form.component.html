<div class="pedido-form-container">
  <!-- Estado de carga -->
  <div class="loading-overlay" *ngIf="vm.isLoading()">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <!-- Mensaje de error -->
  <div class="error-alert" *ngIf="vm.errorMessage()">
    <span class="error-icon">‚ö†Ô∏è</span>
    <p>{{ vm.errorMessage() }}</p>
  </div>

  <!-- Secci√≥n 1: Informaci√≥n General -->
  <div class="form-section">
    <h2 class="section-title">üìã Informaci√≥n General</h2>
    
    <div class="form-row">
      <div class="form-group flex-2">
        <label for="proveedor">Proveedor *</label>
        <select
          id="proveedor"
          class="form-control"
          [value]="vm.proveedorSeleccionado()"
          (change)="onProveedorChange($event)"
          [disabled]="vm.modoEdicion()">
          <option value="">Seleccione un proveedor</option>
          <option *ngFor="let proveedor of vm.proveedores()" [value]="proveedor.id">
            {{ proveedor.nombreEmpresa }}
          </option>
        </select>
      </div>

      <div class="form-group" *ngIf="vm.modoEdicion()">
        <label for="estado">Estado *</label>
        <select
          id="estado"
          class="form-control"
          [value]="vm.estadoSeleccionado()"
          (change)="onEstadoChange($event)">
          <option *ngFor="let estado of getEstadosDisponibles()" [value]="estado">
            {{ estado }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="direccion">Direcci√≥n de entrega *</label>
      <input
        id="direccion"
        type="text"
        class="form-control"
        [value]="vm.direccionEntrega()"
        (input)="onDireccionChange($event)"
        placeholder="Calle, n√∫mero, ciudad, c√≥digo postal">
    </div>
  </div>

  <!-- Secci√≥n 2: L√≠neas de Pedido -->
  <div class="form-section">
    <div class="section-header">
      <h2 class="section-title">üì¶ L√≠neas de Pedido</h2>
      <button
        type="button"
        class="btn btn-add"
        (click)="vm.agregarLinea()"
        [disabled]="!vm.proveedorSeleccionado()">
        <span>‚ûï</span> Agregar l√≠nea
      </button>
    </div>

    <div class="lineas-container" *ngIf="vm.lineasPedido().length > 0">
      <app-linea-pedido-item
        *ngFor="let linea of vm.lineasPedido(); let i = index"
        [linea]="linea"
        [index]="i"
        [productos]="vm.productosDisponibles()"
        (lineaChange)="vm.onLineaChange(i, $event)"
        (eliminar)="vm.eliminarLinea(i)">
      </app-linea-pedido-item>
    </div>

    <div class="empty-lineas" *ngIf="vm.lineasPedido().length === 0">
      <div class="empty-icon">üì¶</div>
      <p>No hay l√≠neas de pedido. Agrega productos para continuar.</p>
    </div>
  </div>

  <!-- Secci√≥n 3: Totales -->
  <div class="form-section totales-section">
    <div class="totales-card">
      <div class="total-row">
        <span class="total-label">Subtotal:</span>
        <span class="total-value">{{ vm.subtotalPedido() | currency: 'EUR' }}</span>
      </div>
      <div class="total-row">
        <span class="total-label">IVA:</span>
        <span class="total-value">{{ vm.impuestosPedido() | currency: 'EUR' }}</span>
      </div>
      <div class="total-row total-final">
        <span class="total-label">Total:</span>
        <span class="total-value">{{ vm.totalPedido() | currency: 'EUR' }}</span>
      </div>
    </div>
  </div>

  <!-- Botones de acci√≥n -->
  <div class="form-actions">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="onCancelar()">
      Cancelar
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="onGuardar()"
      [disabled]="!puedeGuardar()">
      {{ vm.modoEdicion() ? 'Actualizar' : 'Crear' }} Pedido
    </button>
  </div>
</div>
