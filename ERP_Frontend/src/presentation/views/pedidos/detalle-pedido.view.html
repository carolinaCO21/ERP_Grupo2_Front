<div class="app-layout">
  <app-header></app-header>
  
  <div class="main-content">
    <app-sidebar></app-sidebar>
    
    <main class="content-area">
      <!-- Loading -->
      <div class="loading-container" *ngIf="viewModel.cargando">
        <div class="spinner-large"></div>
        <p>Cargando detalle del pedido...</p>
      </div>

      <!-- Error -->
      <div class="error-container" *ngIf="viewModel.error && !viewModel.cargando">
        <span class="error-icon">‚ö†Ô∏è</span>
        <p>{{ viewModel.error }}</p>
        <button class="btn btn-secondary" (click)="ngOnInit()">
          Reintentar
        </button>
      </div>

      <!-- Detalle del pedido -->
      <div class="pedido-detalle" *ngIf="!viewModel.cargando && !viewModel.error && viewModel.pedido">
        <!-- Header con acciones -->
        <div class="detalle-header">
          <div class="header-title">
            <button [routerLink]="['/pedidos']" class="btn-back">
              <span>‚Üê</span> Volver
            </button>
            <h1 class="page-title">
              <span class="title-icon">üì¶</span>
              Pedido {{ viewModel.pedido.numeroPedido }}
            </h1>
            <span 
              class="badge-estado"
              [ngClass]="viewModel.obtenerClaseEstado(viewModel.pedido.estado)">
              {{ viewModel.obtenerTextoEstado(viewModel.pedido.estado) }}
            </span>
          </div>

          <div class="header-actions">
            <button 
              [routerLink]="['/pedidos/editar', viewModel.pedido.id]" 
              class="btn btn-primary">
              <span>‚úèÔ∏è</span> Editar
            </button>
            <button (click)="onImprimir()" class="btn btn-secondary">
              <span>üñ®Ô∏è</span> Imprimir
            </button>
            <button (click)="onExportarPDF()" class="btn btn-secondary">
              <span>üìÑ</span> PDF
            </button>
            <button (click)="onEnviarEmail()" class="btn btn-secondary">
              <span>üìß</span> Email
            </button>
          </div>
        </div>

        <!-- Informaci√≥n general -->
        <div class="info-grid">
          <div class="info-card">
            <h3 class="card-title">
              <span class="card-icon">üè¢</span>
              Informaci√≥n del Proveedor
            </h3>
            <div class="info-content">
              <div class="info-row">
                <span class="info-label">Nombre:</span>
                <span class="info-value">{{ viewModel.pedido.nombreProveedor }}</span>
              </div>
            </div>
          </div>

          <div class="info-card">
            <h3 class="card-title">
              <span class="card-icon">üë§</span>
              Informaci√≥n del Usuario
            </h3>
            <div class="info-content">
              <div class="info-row">
                <span class="info-label">Responsable:</span>
                <span class="info-value">{{ viewModel.pedido.nombreUsuario }}</span>
              </div>
            </div>
          </div>

          <div class="info-card">
            <h3 class="card-title">
              <span class="card-icon">üìÖ</span>
              Informaci√≥n del Pedido
            </h3>
            <div class="info-content">
              <div class="info-row">
                <span class="info-label">Fecha:</span>
                <span class="info-value">{{ viewModel.pedido.fechaPedido | date: 'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Estado:</span>
                <span class="info-value">{{ viewModel.obtenerTextoEstado(viewModel.pedido.estado) }}</span>
              </div>
            </div>
          </div>

          <div class="info-card">
            <h3 class="card-title">
              <span class="card-icon">üìç</span>
              Direcci√≥n de Entrega
            </h3>
            <div class="info-content">
              <p class="direccion-text">{{ viewModel.pedido.direccionEntrega }}</p>
            </div>
          </div>
        </div>

        <!-- L√≠neas de pedido -->
        <div class="lineas-section">
          <h2 class="section-title">
            <span class="section-icon">üìã</span>
            L√≠neas del Pedido
          </h2>

          <div class="table-container">
            <table class="lineas-table">
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Producto</th>
                  <th class="text-center">Cantidad</th>
                  <th class="text-right">Precio Unit.</th>
                  <th class="text-right">Subtotal</th>
                  <th class="text-center">IVA %</th>
                  <th class="text-right">Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let linea of viewModel.pedido.lineasPedido">
                  <td class="codigo-cell">{{ linea.codigoProducto }}</td>
                  <td class="producto-cell">{{ linea.nombreProducto }}</td>
                  <td class="text-center cantidad-cell">{{ linea.cantidad }}</td>
                  <td class="text-right precio-cell">{{ linea.precioUnitario | currency: 'EUR' }}</td>
                  <td class="text-right">{{ linea.subtotal | currency: 'EUR' }}</td>
                  <td class="text-center">{{ linea.ivaPorcentaje }}%</td>
                  <td class="text-right total-cell">{{ linea.totalLinea | currency: 'EUR' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Totales -->
        <div class="totales-section">
          <div class="totales-card">
            <div class="total-row">
              <span class="total-label">Subtotal:</span>
              <span class="total-value">{{ viewModel.pedido.subtotal | currency: 'EUR' }}</span>
            </div>
            <div class="total-row">
              <span class="total-label">Impuestos:</span>
              <span class="total-value">{{ viewModel.pedido.impuestos | currency: 'EUR' }}</span>
            </div>
            <div class="total-row total-final">
              <span class="total-label">TOTAL:</span>
              <span class="total-value">{{ viewModel.pedido.total | currency: 'EUR' }}</span>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>